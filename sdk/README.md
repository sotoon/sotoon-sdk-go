# Sotoon Go SDK v0.1.0 — Initial Release (2025-10-08)

This is the first public release of the Sotoon Go SDK. The initial focus is the Identity and Access Management (IAM) module, which is ready for production use. Other modules exist but are not yet ready.

## Highlights

- **[GA] IAM module (`sdk/core/iam/`)**
  - `Handler` wrapper over the generated `ClientWithResponses` with interceptor support.
  - Constructor `iam.NewHandler(server, secretKey, opts...)` and option `iam.WithInterceptor(...)`.
  - Add interceptors later via `(*Handler).AddInterceptors(...)`.
- **[SDK aggregator] Top-level `SDK` wrapper (`sdk/sdk.go`)**
  - `sotton.NewSDK(secretKey, opts...)` wires up service handlers and the default API base: `https://api.sotoon.ir`.
  - Global option `sotton.WithInterceptor(...)` applies interceptors to all handlers.
- **[Interceptors] Extensible cross-cutting behaviors (`sdk/interceptors/`)**
  - Built-in: Authenticator, Logger, Retry, TreatAsError.
  - Pluggable via `interceptors.Interceptor` interface and executed by `InterceptorTransport`.
- **[Generated clients] Typed code from OpenAPI**
  - Generated by `oapi-codegen`; IAM types live in `sdk/core/iam/types.gen.go`.
  - Handlers wrap `ClientWithResponses` to provide a convenient, interceptor-enabled client.

## Module Stability

- **Stable/Ready**: `sdk/core/iam`
- **Not yet ready**: `sdk/core/compute`, `sdk/core/sotoon-kubernetes-engine`
  - Present in the SDK for forward compatibility but considered experimental for this release.

## Install

```bash
go get github.com/sotoon/sotoon-sdk-go@v0.1.0
```

## Getting Started

- **Use the top-level SDK (recommended)**:

```go
package main

import (
    "context"
    sotton "github.com/sotoon/sotoon-sdk-go/sdk"
    "github.com/sotoon/sotoon-sdk-go/sdk/interceptors"
)

func main() {
    secretKey := "<YOUR_SECRET>"

    sdk, err := sotton.NewSDK(secretKey,
        sotton.WithInterceptor(
            interceptors.NewAuthenticator(secretKey),
            // add optional logger/retry/treat-as-error as needed
        ),
    )
    if err != nil { panic(err) }

    iam := sdk.Iam

    // Interceptors can also be added per-module later:
    iam.AddInterceptors(interceptors.NewLogger(interceptors.LoggerOptions{LogBasicInfo: true}))

    ctx := context.Background()
    // Call generated IAM client methods on iam.ClientWithResponses, e.g.:
    // resp, err := iam.ClientWithResponses.<YourOperation>(ctx, /* params */)
    // Handle resp and err according to the generated method’s types.
}
```

- **Or construct IAM directly**:

```go
import (
    iam "github.com/sotoon/sotoon-sdk-go/sdk/core/iam"
    "github.com/sotoon/sotoon-sdk-go/sdk/interceptors"
)

handler, err := iam.NewHandler("https://api.sotoon.ir", "<YOUR_SECRET>",
    iam.WithInterceptor(
        interceptors.NewAuthenticator("<YOUR_SECRET>"),
        // optional: logger/retry/treat-as-error
    ),
)
if err != nil { panic(err) }

// Use handler.ClientWithResponses.<YourOperation>(...)
```

## Notable IAM Types

Representative models from `sdk/core/iam/types.gen.go`:
- **`IamGroup`**, **`IamGroupDetail`**, **`IamGroupMinimal`**
- **`IamRoleMinimal`**, **`IamCreateRole`**
- **`IamUser`**, **`IamCreateUser`**
- **`IamBackupKey`**, **`IamCreateUserKiseKey`**
- Common envelope/utility types like **`Empty`**, **`IamError`**

(See `sdk/core/iam/types.gen.go` for the complete, generated type set.)

## Interceptors

Located under `sdk/interceptors/`:
- **`Authenticator`**: `NewAuthenticator(secretKey)` adds `Authorization: Bearer <secretKey>`.
- **`Logger`**: `NewLogger(LoggerOptions{...})` logs requests/responses.
- **`Retry`**: `NewRetryInterceptor(...)` with pluggable backoff and retry deciders.
- **`TreatAsError`**: `NewTreatAsErrorInterceptor(...)` to turn non-2xx responses into errors.

Attach globally via `sotton.WithInterceptor(...)` in `sotton.NewSDK(...)`, or per-module via `(*Handler).AddInterceptors(...)`.

## Known Limitations

- **SDK surface**: Only IAM is validated and supported for production.
- **Generated files**: `client.gen.go`, `types.gen.go`, and `sdk/sdk.go` are auto-generated and will be overwritten by the generator.
- **Handlers**: `handler.go` files are not overwritten; safe to customize.

## Roadmap

- Stabilize and ship `compute` and `sotoon-kubernetes-engine`.
- Expand examples and quickstarts per IAM operation.
- Add higher-level helpers atop generated operations where useful.

## Changelog

- **Added**: IAM module with handler and typed client.
- **Added**: Interceptor framework and default implementations.
- **Added**: Top-level `SDK` wrapper with global interceptor option.
